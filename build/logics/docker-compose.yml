volumes:
  docker-server:

services:
  db:
    image: postgres:15.4
    volumes:
      - ./docker-db:/var/lib/postgresql/data
    environment:
      POSTGRES_PASSWORD: 11111 # postgres requires password to be set

  logics:
    image: <${docker.repo.name}/${project.artifactId}:${build.timestamp}>
#    image: local/mycompany:2024-11-01.11-14
    volumes:
      - docker-server:/lsfusion

  server:
    image: lsfusion/server:test
    depends_on:
      - db
      - logics
    volumes:
      - docker-server:/lsfusion

    environment:
      - DB_PASSWORD=11111
      - DB_SERVER=db
      #      - DB_USER=postgres
      #      - DB_NAME=lsfusion
      #      - JAVA_OPTS=-Xmx4000m
      - LANG=${LANG} # set locale from the host because the image openjdk from lsfusion/server uses C.UTF-8 locale

  client:
    image: lsfusion/client:test
    depends_on:
      - server
    volumes:
      - ./docker-client-conf:/usr/local/tomcat/conf/Catalina # host/path:container/path
    ports:
      - "8080:8080"
    environment:
      - APP_REGISTRY_SERVER=server
      - LANG=${LANG} # set locale from the host because the image tomcat from lsfusion/client uses C.UTF-8 locale
#      - SERVER_HOST=server
#      - SERVER_PORT=7652
#      - JAVA_OPTS=-Xmx4000m


# todo need to do the same in platform`s docker-compose